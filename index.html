<!DOCTYPE html> 
<html>

<head>
	<meta name="viewport" content="width=device-width, initial-scale=1"> 
	<title>PathFinder</title> 

	<!-- phonegap libs -->
	<script type="text/javascript" charset="utf-8" src="phonegap.js"></script>
	<script type="text/javascript" charset="utf-8" src="childbrowser.js"></script>

	<!-- jquery libs -->
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.css" />
	<script src="http://code.jquery.com/jquery-1.8.2.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.js"></script>
	
	<!-- google map libs -->
	<script type="text/javascript" charset="utf-8" src="https://maps.googleapis.com/maps/api/js?sensor=true&libraries=places"></script>

	<script type="text/javascript" charset="utf-8">
		// wait for phonegap to load
		document.addEventListener("deviceready", onDeviceReady, false);
		// init maps on load
		//google.maps.event.addDomListener(window, 'load', initMap);

		// phonegap is ready
		function onDeviceReady() {
			var element = document.getElementById('geolocation');
			element.innerHTML = 
				'PhoneGap Loaded.';
			navigator.geolocation.getCurrentPosition(onSuccess, onError);
		}

		// onSuccess Geolocation
		function onSuccess(position) {
			var element = document.getElementById('geolocation');
			element.innerHTML = 
				'Latitude: ' + position.coords.latitude + '<br />' +
				'Longitude: ' + position.coords.longitude + '<br />' +
				'Altitude: ' + position.coords.altitude + '<br />' +
				'Accuracy: ' + position.coords.accuracy + '<br />' +
				'Altitude Accuracy: ' + position.coords.altitudeAccuracy + '<br />' +
				'Heading: ' + position.coords.heading + '<br />' +
				'Speed: ' + position.coords.speed + '<br />' +
				'Timestamp: ' + new Date(position.timestamp) + '<br />';

			$('#map').text("initalising map");
			initMap(position.coords.latitude, position.coords.longitude, 500);
		}

		function onError(error) {
			var element = document.getElementById('geolocation');
			element.innerHTML = 
				'Code: ' + error.code +
				'<br />' +
				'Msg: ' + error.message;
		}

		// map js code
		var map;
		var infowindow;

		function initMap(lat, long, rad) {
			var pyrmont = new google.maps.LatLng(lat, long);

			var map = new google.maps.Map(document.getElementById('map'), {
				mapTypeId: google.maps.MapTypeId.ROADMAP,
				center: pyrmont,
				zoom: 15
				});

			// finetune radius to 100 < rad < (accuracy * 3)
			if ((rad * 3) < 100) {
				rad = 100;
			} else {
				rad = rad * 3;
			}
			$('#logs').append('<p>radius = ' + rad + '</p>');

			var request = {
				location: pyrmont,
		  		radius: rad,
		  		types: ['accounting', 'airport ', 'amusement_park', 
				  	'aquarium ', 'art_gallery', 'bakery ', 
					'bank ', 'bar ', 'beauty_salon', 
					'bicycle_store', 'book_store', 'bowling_alley', 
					'bus_station', 'cafe ', 'campground ', 
					'car_dealer', 'car_rental', 'car_repair', 
					'casino ', 'church ', 'city_hall', 
					'clothing_store', 'convenience_store', 
					'courthouse', 'dentist ', 'department_store', 
					'doctor', 'electrician', 'electronics_store', 
					'embassy ', 'establishment ', 'finance ', 
					'florist ', 'food ', 'furniture_store', 
					'gas_station', 'general_contractor', 'grocery_or_supermarket', 
					'gym ', 'hair_care', 'hardware_store', 
					'health ', 'hindu_temple', 'home_goods_store', 
					'hospital ', 'insurance_agency', 'jewelry_store', 
					'laundry ', 'lawyer ', 'library ', 
					'liquor_store', 'local_government_office', 'locksmith ', 
					'lodging ', 'meal_delivery', 'meal_takeaway', 
					'mosque', 'movie_rental', 'movie_theater', 
					'moving_company', 'museum ', 'night_club', 
					'painter ', 'park ', 'pet_store', 
					'pharmacy ', 'physiotherapist ', 'place_of_worship', 
					'plumber ', 'police ', 'post_office', 
					'real_estate_agency', 'restaurant ', 'roofing_contractor', 
					'rv_park', 'school ', 'shoe_store', 
					'shopping_mall', 'spa', 'stadium ', 
					'storage ', 'store ', 'subway_station', 
					'synagogue ', 'taxi_stand', 'train_station', 
					'travel_agency', 'university', 'veterinary_care', 
					'zoo ', 'colloquial_area', 'floor', 
					'point_of_interest', 'post_box', 'premise', 
					'room', 'subpremise', 'transit_station']
			};
			
			var service = new google.maps.places.PlacesService(map);
			service.search(request,mapCallBack);
		}

		function mapCallBack(results, status) {
			if (status == google.maps.places.PlacesServiceStatus.OK) {
				for (var i = 0; i < results.length; i++) {
					var place = results[i];
					var placeLoc = place.geometry.location;
					var placeName = place.name;

					$('#places').append(
							'<li data-filtertext="' + placeName + '"><a href="#">' + placeName + '</a></li>'
							);
				}
				$('#places').listview('refresh');
			}
		}

	</script>
</head> 
<body> 
	<div data-role="page" id="one">

		<div data-role="header">
			<h1>PathFinder</h1>
		</div>

		<div data-role="content">
			<div>
				<h2>Golocation</h2>
				<p id="geolocation">
				Finding Geolocation...
				</p>
			</div>
			<div>
				<h2>Maps</h2>
				<p id="map">

				</p>
			</div>
			<div>
				<h2>Places</h2>
				<ul id="places" data-role="listview" data-filter="true" data-filter-placeholder="Search places..." data-inset="true">
				</ul>
			</div>
			<div>
				<h2>Logs</h2>
				<div id="logs">

				</div>	
			</div>
		</div>

	</div>

</body>
</html>
